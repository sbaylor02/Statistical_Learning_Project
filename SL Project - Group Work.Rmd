---
title: "Statistical Learning Project"
output: html_notebook
---

Sarah, Pavel, Rose, Catherine, Shravya
East
Statistical Learning Project


```{r}
library(tidyverse)
library(reshape2)
library(readxl)
library(caret)
library(rpart) 
library(partykit) 
library(randomForest)
library(class)
```

```{r}

#Read in the data
dat <- read_excel("Absenteeism_at_work.xls")

#View the data
glimpse(dat)

```
##Pre-Processing Data
```{r}
#Set factored variables as factors
col <- c("ID", "Reason for absence", "Month of absence", "Day of the week", "Seasons", "Disciplinary failure", "Education", "Social drinker",   "Social smoker", "Pet", "Son")
dat[col] <- lapply(dat[col], as.factor)

#Rename the columns for easier use
colnames(dat) <- c("ID", "Reason", "Month", "Day", "Seasons", "Transportation_expense", "Distance", "Service_time", "Age", "Work_load", "Hit_target", "Disciplinary_failure", "Education", "Children", "Social_drinker", "Social_smoker", "Pet", "Weight", "Height", "BMI", "Absent_time")

#View the data
glimpse(dat)



```


```{r}
# Still need to reset levels on vrariables so ordered factors are graphed in order
```

```{r}
nums <- unlist(lapply(dat, is.numeric))  
dat.num <- dat[ , nums]

```
## EDA Response Variable

### Absent_time
```{r}
summary(dat$Absent_time)

```


```{r}
table(dat$Absent_time)
```

```{r}
#change variable represent missed time one day or greater
dat <- dat %>% mutate(Absent_time= ifelse(dat$Absent_time <=8,0,1))
```

```{r}
ggplot(data = dat,
       aes(x = Absent_time)) +
  geom_histogram() + 
  theme_minimal()
```
```{r}
dat %>%
  gather(-Absent_time, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Absent_time)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
```


## EDA Predictors

### ID
### Reason
### Month
### Day

```{r}
dat %>%
  gather(-Day, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Day)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
```


### Seasons

```{r}
#Scatterplots for variable 'Seasons'
dat %>%
  gather(-Seasons, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Seasons)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
```
### Transportation Expense

```{r}
summary(dat$Transportation_expense)
ggplot(data = dat,
       aes(x = Transportation_expense)) +
  geom_histogram(binwidth = 50) + 
  theme_minimal()
```

```{r}
dat %>%
  gather(-Transportation_expense, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Transportation_expense)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
# Possible positive correlation seen between distance and Transportation_expense
```

###Distance
```{r}
summary(dat$Distance)
ggplot(data = dat,
       aes(x = Distance)) +
  geom_histogram(binwidth = 5) + 
  theme_minimal()
```

```{r}
dat %>%
  gather(-Distance, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Distance)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
#Possible Positive correlation seen between distance and Transportation_expense
```

### Service Time
```{r}
ggplot(data = dat,
       aes(x = Service_time)) +
  geom_histogram() +
  theme_minimal()
```

```{r}
dat %>%
  gather(-Service_time, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Service_time)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")

```

### Age

```{r}
ggplot(data = dat,
       aes(x = Age)) +
  geom_histogram() + 
  theme_minimal()
```

```{r}
dat %>%
  gather(-Age, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Age)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")

```
### Workload

```{r}
summary(dat$Work_load)

ggplot(data = dat,
       aes(x = Work_load)) +
  geom_histogram(binwidth = 5000) + 
  theme_minimal()
```

```{r}
dat %>%
  gather(-Work_load, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Work_load)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
```

### Hit Target

```{r}
ggplot(data = dat,
       aes(x = Hit_target)) + 
  geom_histogram() +
  theme_minimal()
```

```{r}
dat %>%
  gather(-Hit_target, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Hit_target)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")

```
### Disciplinary Failure
dat %>%
  gather(-Disciplinary_failure, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Disciplinary_failure)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
  
### Education

dat %>%
  gather(-Education, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Education)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
  
### Children

dat %>%
  gather(-Children, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Children)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
### Social Drinker

dat %>%
  gather(-Social_drinker, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Social_drinker)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
  
###Social Smoker

```{r}
#Scatterplots for variable 'Social_smoker'
dat %>%
  gather(-Social_smoker, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Social_smoker)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
```


### Pet
### Weight

```{r}
dat %>%
  gather(-Weight, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Weight)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
```
### Height

dat.num %>%
  gather(-Height, key = "var_name", value = "value") %>%
  ggplot(aes(x = value, y = Height)) +
  geom_point() +
  facet_wrap(~ var_name, scales = "free")
### BMI

## Initial Method Testing

```{r}
# chose an odd number near the square root of size of the training set.

sqrt(444)

```


```{r}

####Note KNN code doesn't work yet, so comment out if need be but please insert code into this loop

R <- 50 # replications

# create the matrix to store values 1 row per model
err_matrix <- matrix(0, ncol=5, nrow=R)

sensitivity_matrix <- matrix(0, ncol=5, nrow=R)

fmeasure_matrix <- matrix(0, ncol=5, nrow=R)

gmean_matrix <- matrix(0, ncol=5, nrow=R)


set.seed(1876)
 

for (r in 1:R){
  
  # training test split
# subsetting data to training and testing data
p <- .6 # proportion of data for training
w <- sample(1:nrow(dat), nrow(dat)*p, replace=F)
data_train <-dat[w,] 
data_test <- dat[-w,]

  ########### knn

#Running the classifier

  knn <- knn(data_train[-21],
                       test = data_test[-21],
                       cl=data_train$Absent_time, k=21)
  

  # prediction    
#  yhat_knn <-  predict(#figure out what goes in here, data_test[,-21])
  
  # store the errors (change the 1 to whichever model you have)   
#  err_mat_bag[r,1] <-  mean(yhat_knn!=data_test[,21])
  
  #still need to add other errors
  
  
  ############# Other models follow
  
  
  # just a nice statement to tell you when each loop is done
  cat("Finished Rep",r, "\n")
}



```

